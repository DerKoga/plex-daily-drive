<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plex Daily Drive</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>&#9654; Plex Daily Drive</h1>
            <p class="subtitle">Automatische Playlist-Erstellung &mdash; Musik &amp; Podcasts gemischt</p>
        </header>

        <!-- Status Bar -->
        <div class="card status-card" id="status-card">
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-label">Plex Server</span>
                    <span class="status-value" id="plex-status">Verbinde...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Scheduler</span>
                    <span class="status-value" id="scheduler-status">--</span>
                </div>
                <div class="status-item">
                    <span class="status-label">N&auml;chste Ausf&uuml;hrung</span>
                    <span class="status-value" id="next-run">--</span>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="settings">Einstellungen</button>
            <button class="tab" data-tab="podcasts">Podcasts</button>
            <button class="tab" data-tab="generate">Generieren</button>
            <button class="tab" data-tab="history">Verlauf</button>
        </nav>

        <!-- Settings Tab -->
        <div class="tab-content active" id="tab-settings">
            <div class="card">
                <h2>Plex Verbindung</h2>
                <div class="form-group">
                    <label for="plex-url">Plex URL</label>
                    <input type="text" id="plex-url" placeholder="http://192.168.1.x:32400">
                    <small>IP-Adresse deines Plex Servers (nicht localhost wenn Docker!)</small>
                </div>
                <div class="form-group">
                    <label for="plex-token">Plex Token</label>
                    <div class="token-field">
                        <input type="password" id="plex-token" placeholder="Dein Plex Token">
                        <button type="button" class="btn btn-small btn-secondary" onclick="toggleToken()">Zeigen</button>
                    </div>
                    <small><a href="https://support.plex.tv/articles/204059436/" target="_blank" rel="noopener">Wie finde ich meinen Plex Token?</a></small>
                </div>
                <button class="btn btn-secondary" onclick="testConnection()">Verbindung testen</button>
                <div id="connection-result" class="result-box hidden"></div>
            </div>

            <div class="card">
                <h2>Bibliotheken</h2>
                <div class="form-group">
                    <label>Musik-Bibliotheken</label>
                    <div id="music-libraries" class="library-list">
                        <p class="muted">Lade Bibliotheken...</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Playlist-Konfiguration</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="playlist-prefix">Playlist-Name Prefix</label>
                        <input type="text" id="playlist-prefix" value="Daily Drive">
                    </div>
                    <div class="form-group">
                        <label for="keep-days">Aufbewahren (Tage)</label>
                        <input type="number" id="keep-days" value="7" min="1" max="365">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="music-count">Anzahl Musiktitel</label>
                        <input type="number" id="music-count" value="20" min="0" max="200">
                    </div>
                    <div class="form-group">
                        <label for="podcast-count">Anzahl Podcast-Episoden</label>
                        <input type="number" id="podcast-count" value="3" min="0" max="50">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="podcast-download-path">Podcast Download-Pfad</label>
                        <input type="text" id="podcast-download-path" value="/podcasts">
                        <small>Ordner in dem Podcast-Episoden gespeichert werden</small>
                    </div>
                    <div class="form-group">
                        <label for="podcast-max-episodes">Max. Episoden pro Podcast</label>
                        <input type="number" id="podcast-max-episodes" value="3" min="1" max="50">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Zeitplan</h2>
                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="enabled" checked>
                        Automatische Generierung aktiviert
                    </label>
                </div>
                <div class="form-group">
                    <label>Generierungszeiten</label>
                    <div id="schedules-list"></div>
                    <button class="btn btn-secondary btn-small" onclick="addSchedule()" style="margin-top: 8px">+ Zeit hinzuf&uuml;gen</button>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-primary" onclick="saveSettings()">Einstellungen speichern</button>
                <div id="save-result" class="result-box hidden"></div>
            </div>
        </div>

        <!-- Podcasts Tab -->
        <div class="tab-content" id="tab-podcasts">
            <div class="card">
                <h2>Podcast suchen</h2>
                <div class="search-field">
                    <input type="text" id="podcast-search-input" placeholder="Podcast Name eingeben...">
                    <button class="btn btn-primary" onclick="searchPodcasts()">Suchen</button>
                </div>
                <div id="podcast-search-results"></div>
            </div>

            <div class="card">
                <h2>Abonnierte Podcasts</h2>
                <div id="subscribed-podcasts">
                    <p class="muted">Lade...</p>
                </div>
                <button class="btn btn-secondary" onclick="refreshPodcasts()" id="refresh-podcasts-btn" style="margin-top: 12px">
                    Jetzt neue Episoden laden
                </button>
                <div id="refresh-result" class="result-box hidden"></div>
            </div>
        </div>

        <!-- Generate Tab -->
        <div class="tab-content" id="tab-generate">
            <div class="card center-card">
                <h2>Playlist jetzt generieren</h2>
                <p>Erstellt sofort eine neue Daily Drive Playlist mit den aktuellen Einstellungen.</p>
                <button class="btn btn-primary btn-large" id="generate-btn" onclick="generateNow()">
                    Jetzt generieren
                </button>
                <div id="generate-result" class="result-box hidden"></div>
            </div>

            <div class="card">
                <h2>Aktive Playlists</h2>
                <div id="active-playlists">
                    <p class="muted">Lade...</p>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div class="tab-content" id="tab-history">
            <div class="card">
                <h2>Generierungsverlauf</h2>
                <div id="history-list">
                    <p class="muted">Lade...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
